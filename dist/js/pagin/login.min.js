require(["config"],function(){require(["jquery","url","errorMsg","jquery.swiper","jquery.cookie","jquery.validate"],function(e,r,i){e(function(){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,effect:"fade",loop:!0,autoplay:3e3,speed:1e3,paginationBulletRender:function(){return'<span class="swiper-pagination-bullet"><i></i></span>'}}),r.param("type")&&(e("#loginform").hide(),e("#registerbox").show());var s={id:!1,pwd:!1,repwd:!1};e("#id").blur(function(){var r=this.value,t=e(this);""==r?(i.show(t,e(".errormsg"),"请输入手机号码"),s.id=!1):/^1(3|4|5|7|8)\d{9}$/.test(r)?(i.hide(t,e(".errormsg")),e.ajax({type:"get",url:"json/user.json",success:function(t){t.filter(function(e){return e.id==r}).length?i.show(e(this),e(".errormsg"),"该用户已经存在，请重新输入"):s.id=!0}})):(i.show(e(this),e(".errormsg"),"格式不合法，请重新输入"),s.id=!1)}),e("#registerbox ul li").click(function(){i.hide(e("input"),e(".errormsg")),e(this).index()?(e(".telcheck").hide(),e(this).removeClass("noregister").siblings().addClass("noregister"),e("#id").prop("placeholder","请输入您的电子邮箱"),e("#id").blur(function(){var r=this.value,t=e(this);""==r?(i.show(t,e(".errormsg"),"请输入您的电子邮箱"),s.id=!1):/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/.test(r)?(i.hide(t,e(".errormsg")),e.ajax({type:"get",url:"json/user.json",success:function(t){t.filter(function(e){return e.id==r}).length?i.show(e(this),e(".errormsg"),"该用户已经存在，请重新输入"):s.id=!0}})):(i.show(e(this),e(".errormsg"),"格式不合法，请重新输入"),s.id=!1)})):(e(this).removeClass("noregister").siblings().addClass("noregister"),e("#id").prop("placeholder","请输入您注册的手机号码"),e(".telcheck").show(),e("#id").blur(function(){var r=this.value,t=e(this);""==r?(i.show(t,e(".errormsg"),"请输入手机号码"),s.id=!1):/^1(3|4|5|7|8)\d{9}$/.test(r)?(i.hide(t,e(".errormsg")),e.ajax({type:"get",url:"json/user.json",success:function(t){t.filter(function(e){return e.id==r}).length?i.show(e(this),e(".errormsg"),"该用户已经存在，请重新输入"):s.id=!0}})):(i.show(e(this),e(".errormsg"),"格式不合法，请重新输入"),s.id=!1)}))}),e("#registerPwd").blur(function(){var r=this.value;/^[a-z0-9_-]{6,20}$/.test(r)?(i.hide(e(this),e(".errormsg")),s.pwd=!0):(s.pwd=!1,i.show(e(this),e(".errormsg"),"密码格式不合法，请重新输入"))}),e("#repeatPwd").blur(function(){var r=this.value,t=e("#registerPwd").prop("value");r==t?(s.repwd=!0,i.hide(e(this),e(".errormsg"))):(s.repwd=!1,i.show(e(this),e(".errormsg"),"密码输入不一致，请重新输入"))}),e("#join").click(function(){if(e("#accept").prop("checked")){var r=!0;for(var i in s)if(!s[i]){r=!1;break}if(r){var t={id:e("#id").prop("value"),pwd:e("#registerPwd").prop("value")};e.cookie("user",JSON.stringify(t),{path:"/"}),location.href="index.html"}else e(".errormsg").text("请完整填写注册信息").show()}else e(".errormsg").text("请同意用户相关条款").show()});var t={id:"",pwd:""},o=!1,n=!1;if(e("#username").blur(function(){if(t.id=this.value,t.id){var r=e(this);e.ajax({type:"get",url:"json/user.json",success:function(s){s.filter(function(e){return e.id==t.id}).length?(i.hide(r,e(".errormsg")),o=!0):(i.show(r,e(".errormsg"),"账户不存在，请重新输入"),o=!1)}})}else e(".errormsg").text("请输入邮箱或手机号").show()}),e("#pwd").blur(function(){if(t.pwd=this.value,t.pwd){var r=e(this);e.ajax({type:"get",url:"json/user.json",success:function(s){s.filter(function(e){return e.pwd==t.pwd&&e.id==t.id}).length?(i.hide(r,e(".errormsg")),n=!0):(i.show(r,e(".errormsg"),"用户名或密码输入错误，请重新输入"),n=!1)}})}else i.show(e(this),e(".errormsg"),"请输入密码")}),null!=e.cookie("user")&&"null"!=e.cookie("user")){var u=JSON.parse(e.cookie("user"));console.log(u),t.id=u.id,t.pwd=u.pwd,e("#username").attr("value",t.id),e("#pwd").attr("value",t.pwd),o=!0,n=!0}e("#loginBtn").click(function(){o?n?e("#remember").prop("checked")?(e.cookie("user",JSON.stringify(t),{expires:7,path:"/"}),setTimeout(function(){location.href="index.html"},1e3)):(e.cookie("user",JSON.stringify(t),{path:"/"}),setTimeout(function(){location.href="index.html"},1e3)):e(".errormsg").text("密码输入错误，请重新输入").show():e(".errormsg").text("邮箱或手机号输入错误，请重新输入").show()})})})});